<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel de Administración - Oma Wurst</title>
    <!-- En entorno Vite (desarrollo), servimos CSS desde src -->
    <link rel="stylesheet" href="/src/css/styles.css">
    <link rel="stylesheet" href="/src/css/dashboard.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.14/index.global.min.js"></script>
    <link rel="icon" type="image/png" href="/assets/logo-oma-final.png">
    
</head>
<body>
    <!-- Header superior (visible en la interfaz) -->
    <header class="top-bar">
        <div class="top-bar-content">
            <img src="/assets/logo-oma-final.png" alt="Oma Wurst Logo" class="top-bar-logo">
            <h1 class="top-bar-title">Panel de Administración - Oma Wurst</h1>
        </div>
    </header>

    <div class="dashboard-layout">
        <aside class="sidebar">
            <div class="sidebar-header">
                <img src="/assets/logo-oma-final.png" alt="Oma Wurst Logo" class="sidebar-logo">
                <h1 class="sidebar-title">Oma Wurst</h1>
            </div>
            <nav class="sidebar-nav">
                <ul>
                    <li><a href="#" data-target="dashboard-section"><i class="fas fa-tachometer-alt" aria-hidden="true"></i><span>Inicio</span></a></li>
                    <li class="active"><a href="#" data-target="reservas-section"><i class="fas fa-calendar-alt" aria-hidden="true"></i><span>Reservas</span></a></li>
                    <li><a href="#" data-target="productos-section"><i class="fas fa-box" aria-hidden="true"></i><span>Productos</span></a></li>
                    <li><a href="#" data-target="usuarios-section"><i class="fas fa-users" aria-hidden="true"></i><span>Usuarios</span></a></li>
                </ul>
            </nav>
            <div class="sidebar-footer">
                <a href="#" id="logout-button">
                    <i class="fas fa-arrow-right-from-bracket" aria-hidden="true"></i>
                    <span>Cerrar Sesión</span>
                </a>
            </div>
        </aside>

        <main class="main-content">
            <header class="main-header">
                <div class="main-header-left">
                    <button class="sidebar-toggle" id="sidebar-toggle" type="button" aria-label="Mostrar u ocultar menú">
                        <i class="fas fa-bars"></i>
                    </button>
                    <div class="main-heading">
                        <p class="eyebrow-label">Panel interno</p>
                        <h1 id="main-title">Gestión de Reservas</h1>
                    </div>
                </div>
                <div class="main-header-right">
                    <div class="header-actions">
                        <button class="btn tertiary-btn" id="back-to-dashboard" type="button">
                            <i class="fas fa-arrow-left"></i>
                            <span>Volver al inicio</span>
                        </button>
                        <a href="/index.html" target="_blank" rel="noopener noreferrer" class="btn primary-btn" id="public-site-link">
                            <i class="fas fa-globe"></i>
                            <span>Ver sitio público</span>
                        </a>
                    </div>
                    <div class="admin-profile">
                        <div class="admin-profile-info">
                            <span class="eyebrow-label">Sesión</span>
                            <span id="user-email"></span>
                        </div>
                        <i class="fas fa-user-circle" aria-hidden="true"></i>
                    </div>
                </div>
            </header>

            <!-- DASHBOARD -->
            <section id="dashboard-section" class="main-section">
                <div class="kpi-cards">
                    <div class="kpi-card">
                        <h4>Usuarios Registrados</h4>
                        <p id="kpi-usuarios-registrados">--</p>
                    </div>
                    <div class="kpi-card">
                        <h4>Usuarios Activos</h4>
                        <p id="kpi-usuarios-activos">--</p>
                    </div>
                    <div class="kpi-card">
                        <h4>Nuevas Reservas (Mes)</h4>
                        <p id="kpi-nuevas-reservas">--</p>
                    </div>
                </div>
                <div class="data-table-section">
                    <h3>Últimas Reservas</h3>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Fecha</th>
                                    <th>Cliente</th>
                                    <th>Estado</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="ultimas-reservas-body">
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- RESERVAS -->
            <section id="reservas-section" class="main-section active">
                <div class="controls-section">
                    <div class="filters">
                        <label class="filter-field" for="status-filter">
                            <span>Estado</span>
                            <div class="filter-input">
                                <i class="fas fa-layer-group" aria-hidden="true"></i>
                                <select id="status-filter">
                                    <option value="all">Todos los estados</option>
                                    <option value="Pendiente">Pendiente</option>
                                    <option value="Confirmado">Confirmado</option>
                                    <option value="Completado">Completado</option>
                                    <option value="Cancelado">Cancelado</option>
                                </select>
                            </div>
                        </label>
                        <label class="filter-field" for="date-filter">
                            <span>Fecha</span>
                            <div class="filter-input">
                                <i class="fas fa-calendar-day" aria-hidden="true"></i>
                                <input type="date" id="date-filter">
                            </div>
                        </label>
                    </div>
                    <div class="view-switcher">
                        <button id="btn-view-calendar" class="view-btn active"><i class="fas fa-calendar-alt"></i> Calendario</button>
                        <button id="btn-view-list" class="view-btn"><i class="fas fa-list"></i> Lista</button>
                    </div>
                </div>
                <div class="content-view">
                    <div id="calendar-view" class="view active">
                        <div class="calendar-card">
                            <div id="calendar-container" class="calendar-wrapper"></div>
                        </div>
                    </div>
                    <div id="list-view" class="view">
                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>ID Reserva</th>
                                        <th>Cliente</th>
                                        <th>Fecha de Entrega</th>
                                        <th>Estado</th>
                                        <th>Total</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="reservas-table-body">
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </section>

            <!-- PRODUCTOS -->
            <section id="productos-section" class="main-section">
                <div class="controls-section products-controls">
                    <div class="products-controls-header">
                        <div>
                            <h3>Gestión de Productos</h3>
                            <p class="products-subtitle">Administra el catálogo en tiempo real, busca por nombre o categoría y crea nuevos productos cuando los necesites.</p>
                        </div>
                        <div class="products-actions">
                            <button id="refresh-products-btn" class="btn-product-card secondary" type="button">
                                <i class="fas fa-rotate-right"></i> Actualizar
                            </button>
                            <button id="add-product-btn" class="btn-product-card primary" type="button">
                                <i class="fas fa-plus"></i> Agregar Producto
                            </button>
                        </div>
                    </div>
                    <div class="product-stats-grid">
                        <article class="product-stat-card">
                            <span>Total publicados</span>
                            <strong id="product-total-count">0</strong>
                        </article>
                        <article class="product-stat-card">
                            <span>Categorías activas</span>
                            <strong id="product-category-count">0</strong>
                        </article>
                        <article class="product-stat-card">
                            <span>Sin imagen</span>
                            <strong id="product-missing-images-count">0</strong>
                        </article>
                    </div>
                    <div class="product-filters">
                        <label class="product-search-field">
                            <i class="fas fa-search"></i>
                            <input type="search" id="product-search-input" placeholder="Buscar por nombre, categoría o descripción">
                        </label>
                        <label>
                            <span class="sr-only">Filtrar por categoría</span>
                            <select id="product-category-filter">
                                <option value="all">Todas las categorías</option>
                            </select>
                        </label>
                        <label>
                            <span class="sr-only">Ordenar productos</span>
                            <select id="product-sort-select">
                                <option value="recent">Más recientes</option>
                                <option value="price_desc">Precio: mayor a menor</option>
                                <option value="price_asc">Precio: menor a mayor</option>
                                <option value="name_asc">Nombre A-Z</option>
                            </select>
                        </label>
                        <button id="product-reset-filters" class="btn-reset-filters" type="button">
                            <i class="fas fa-eraser"></i> Limpiar filtros
                        </button>
                    </div>
                </div>
                <div id="products-loading-indicator" class="products-loading-indicator" hidden>
                    <i class="fas fa-spinner fa-spin"></i>
                    <span>Sincronizando productos…</span>
                </div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Imagen</th>
                                <th>Título</th>
                                <th>Categoría</th>
                                <th>Precio</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="products-table-body">
                        </tbody>
                    </table>
                </div>
                <button id="quick-add-product-btn" class="fab-add-product btn-product-card primary" type="button" aria-label="Agregar nuevo producto">
                    <i class="fas fa-plus"></i>
                    <span>Nuevo producto</span>
                </button>
                <div id="products-empty-state" class="products-empty-state" hidden>
                    <p id="products-empty-message">No encontramos productos para los filtros seleccionados.</p>
                    <button type="button" class="btn-product-card primary" id="empty-state-add-product-btn">
                        <i class="fas fa-plus"></i> Crear el primero
                    </button>
                </div>
            </section>

            <!-- MODAL PRODUCTO -->
            <div id="product-modal" class="modal-admin">
                <div class="modal-admin-content">
                    <button id="modal-product-close-btn" class="modal-close-btn" aria-label="Cerrar">×</button>
                    <h3 id="modal-product-title-form">Agregar Nuevo Producto</h3>
                    <form id="product-form">
                        <input type="hidden" id="product-id">
                        <div class="form-group">
                            <label for="product-title">Título</label>
                            <input type="text" id="product-title" required>
                        </div>
                        <div class="form-group">
                            <label for="product-description">Descripción</label>
                            <textarea id="product-description" rows="4" required></textarea>
                        </div>
                        <div class="form-group-row">
                            <div class="form-group">
                                <label for="product-category-select">Categoría</label>
                                <select id="product-category-select" required>
                                    <option value="" disabled selected>Selecciona una categoría</option>
                                </select>
                                <p class="form-help-text">Elige una categoría existente o crea una nueva.</p>
                            </div>
                            <div class="form-group">
                                <label for="product-price">Precio</label>
                                <input type="number" id="product-price" step="1" required>
                            </div>
                        </div>
                        <div class="form-group" id="new-category-wrapper" style="display:none;">
                            <label for="product-category-new">Nueva categoría</label>
                            <input type="text" id="product-category-new" placeholder="Ej: Parrilleros Premium">
                            <p class="form-help-text">Esta categoría se agregará al catálogo y quedará disponible en futuros productos.</p>
                        </div>
                        <div class="form-group">
                            <label for="product-images">Imágenes (la primera será la principal)</label>
                            <input type="file" id="product-images" multiple accept="image/*">
                            <div id="image-previews" class="image-previews"></div>
                        </div>
                        <div class="form-actions">
                            <button type="submit" class="btn-submit">Guardar Producto</button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- USUARIOS -->
            <section id="usuarios-section" class="main-section">
                <div class="controls-section">
                    <div class="filters">
                        <label class="filter-field" for="user-role-filter">
                            <span>Rol</span>
                            <div class="filter-input">
                                <i class="fas fa-user-tag" aria-hidden="true"></i>
                                <select id="user-role-filter">
                                    <option value="all">Todos los roles</option>
                                    <option value="owner">Owner</option>
                                    <option value="admin">Admin</option>
                                    <option value="staff">Staff</option>
                                    <option value="customer">Cliente</option>
                                </select>
                            </div>
                        </label>
                        <label class="filter-field" for="user-search-input">
                            <span>Buscar</span>
                            <div class="filter-input">
                                <i class="fas fa-search" aria-hidden="true"></i>
                                <input type="text" id="user-search-input" placeholder="Email o nombre">
                            </div>
                        </label>
                    </div>
                    <div class="header-actions">
                        <button id="refresh-users-btn" class="btn-product-card secondary" type="button">
                            <i class="fas fa-rotate-right"></i> Actualizar
                        </button>
                    </div>
                </div>
                <div id="users-loading-indicator" class="products-loading-indicator" hidden>
                    <i class="fas fa-spinner fa-spin"></i>
                    <span>Cargando usuarios…</span>
                </div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Usuario</th>
                                <th>Email</th>
                                <th>Rol</th>
                                <th>Estado</th>
                                <th>Último acceso</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="users-table-body">
                            <!-- Se llena dinámicamente -->
                        </tbody>
                    </table>
                </div>
            </section>
        </main>
    </div>

    <!-- Modal de edición de usuario (nuevo) -->
    <div id="user-modal" class="modal-admin">
        <div class="modal-admin-content">
            <button id="modal-user-close" class="modal-close-btn" aria-label="Cerrar">×</button>
            <h3 id="modal-user-title">Editar Usuario</h3>
            <form id="user-form">
                <input type="hidden" id="user-id">
                <div class="form-group">
                    <label for="user-email-form">Email</label>
                    <input type="email" id="user-email-form" readonly>
                </div>
                <div class="form-group">
                    <label for="user-role-select">Rol</label>
                    <select id="user-role-select" required>
                        <option value="customer">Cliente</option>
                        <option value="staff">Staff</option>
                        <option value="admin">Admin</option>
                        <option value="owner">Owner</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="user-is-active"> Cuenta activa
                    </label>
                </div>
                <div class="form-actions">
                    <button type="submit" class="btn-submit">Guardar Cambios</button>
                </div>
            </form>
        </div>
    </div>

    <div id="dashboard-toast" class="dashboard-toast" aria-live="polite"></div>

    <script type="module" src="/src/js/dashboard.js"></script>
</body>
</html>